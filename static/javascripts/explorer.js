"use strict";const walletAddress=document.getElementById("search"),searchButton=document.getElementById("searchButton"),notFound=document.getElementById("notfound"),assets=document.getElementById("assets"),dapps=document.getElementById("dapps"),form=document.getElementById("form"),loader=document.getElementById("loader"),server_url="https://cardaworlds.io";async function getRarities(){try{const e=await fetch(server_url+"/GetRarityRanks",{dataType:"json",method:"GET",headers:{"Content-Type":"application/json"}});return await e.json()}catch(e){return console.log(e),notFound.innerHTML="There was an error loading part of the script. Rarity information is temporarily unavailable.",null}}var rarityTools;async function searchAddress(){const e={all_nfts:[],walletAddress:walletAddress.value,policyID:"8dd5717e7d4d993019dbd788c19837910e3fcf647ab282f828c80a7a"},t=convertASCIItoHex(e.walletAddress);setState({formHidden:!0,buttonLabel:"Searching..."}),e.walletAddress.startsWith("CardaWorld")?getNftDetails(rarityTools,e.all_nfts,e.policyID+t):e.walletAddress.startsWith("addr1")?fetch(server_url+"/CheckPoolPm/"+e.walletAddress,{dataType:"jsonp",method:"GET"}).then(e=>e.json()).then(t=>{var a=t.tokens,s=0;a.map(t=>{if(t.policy.startsWith(e.policyID)&&t.quantity>0){s+=1;var a=convertASCIItoHex(t.name),n=e.policyID+a,r=t.metadata,o="https://infura-ipfs.io/ipfs/"+r.image.replace("ipfs://",""),i={asset_id:n,description:r.description,name:r.name,imageURL:o,rarities:r["rare biomes"],moons:r.moons,galaxyType:r["galaxy type"],viewerIpfs:r.files[0].src.replace("ipfs://",""),rings:r.rings,planetType:r["planet type"],planetName:r["planet name"],planetSize:r["planet size"],atmosphere:r.atmosphere,rarityRank:"Unavailable",rarityScore:"Unavailable"};rarityTools&&(i.rarityRank=rarityTools[t.name],i.rarityScore=rarityTools[t.name].rarityScore),e.all_nfts=e.all_nfts.concat(i)}}),setState(0==s?{formHidden:!1,buttonLabel:"Search",notFoundText:"CardaWorlds not found for this address. Please check the address or try again.",all_nfts:e.all_nfts}:{formHidden:!1,buttonLabel:"Search",notFoundText:"",all_nfts:e.all_nfts})}).catch(e=>{console.log(e),setState({formHidden:!1,buttonLabel:"Search",notFoundText:"CardaWorlds not found for this address. Please check the address or try again."})}):setState({formHidden:!1,buttonLabel:"Search",notFoundText:"CardaWorlds not found for this address. Please enter a valid address."}),setState({all_nfts:[]})}function getNftDetails(e,t,a){fetch(server_url+"/CheckAsset/"+a,{dataType:"jsonp",method:"GET"}).then(e=>e.json()).then(a=>{var s=a.onchain_metadata,n="https://infura-ipfs.io/ipfs/"+s.image.replace("ipfs://",""),r={asset_id:a.asset,asset_name:a.name,name:s.name,imageURL:n,rarities:s["rare biomes"],moons:s.moons,galaxyType:s["galaxy type"],viewerIpfs:s.files[0].src.replace("ipfs://",""),rings:s.rings,planetType:s["planet type"],planetName:s["planet name"],planetSize:s["planet size"],atmosphere:s.atmosphere,rarityRank:"Unavailable",rarityScore:"Unavailable"};e&&(r.rarityRank=e[s.name.replace(" #","")].rarityRank,r.rarityScore=e[s.name.replace(" #","")].rarityScore),a.quantity>0&&setState({all_nfts:t.concat(r),formHidden:!1,buttonLabel:"Search",notFoundText:""})}).catch(e=>{console.log(e)})}function setState(e){if(void 0!==e.formHidden&&(e.formHidden?(form.style.display="none",loader.style.display="block"):(form.style.display="block",loader.style.display="none")),void 0!==e.buttonLabel&&(searchButton.innerHTML=e.buttonLabel),void 0!==e.notFoundText&&(notFound.innerHTML=e.notFoundText),void 0!==e.dapps&&(dapps.innerHTML=e.dapps),void 0!==e.all_nfts){const t=[];for(const a in e.all_nfts){const s=e.all_nfts[a];t.push('<div class="asset">'),t.push(`<img src="${s.imageURL}">`),t.push(`<h3>${s.name}</h3>`),t.push(`<h4>${s.planetName}</h4>`),t.push("<p>Features</p>"),t.push('<div class="features">'),"No"!==s.moons&&t.push('<div class="feature">Moons</div>'),"No"!==s.rings&&t.push('<div class="feature">Gyros</div>'),t.push(`<div class="feature">${s.planetType}</div>`),t.push(`<div class="feature">${s.galaxyType} Galaxy</div>`),t.push(`<div class="feature">${s.atmosphere} Atmosphere</div>`),t.push(`<div class="feature">${s.rarities}</div>`),t.push("</div>"),t.push("<p>Rarity</p>"),t.push('<div class="features features__rarity">'),t.push(`<div class="feature">Rarity rank: ${s.rarityRank}</div>`),t.push("</div>"),t.push('<div class="asset__links">'),t.push(`<a class="vr" href="https://www.jpg.store/asset/${s.asset_id}" target="_blank" rel="noopener noreferrer">More Details</a>`),t.push(`<a class="vr" href="https://ipfs.cardaworlds.io/ipfs/${s.viewerIpfs}" target="_blank" rel="noopener noreferrer">View in 3D</a>`),t.push("</div>"),t.push("</div>")}assets.innerHTML=t.join("")}}function convertASCIItoHex(e){const t=[],a=e.split("");for(let e=0;e<a.length;e++){const s=a[e].charCodeAt(0).toString(16);t.push(s)}return t.join("")}searchButton.addEventListener("click",searchAddress),walletAddress.addEventListener("keypress",function(e){"Enter"===e.key&&searchButton.click()}),(async()=>{rarityTools=await getRarities()})();const isBrowser=()=>"undefined"!=typeof window;async function getCardano(){return isBrowser()&&window.cardano}var observer=new MutationObserver(async function(e,t){const a=await getCardano();if(a)return instantiateDapps(a),void t.disconnect()});async function instantiateDapps(e){try{const t=e?Object.keys(e).filter(e=>"nami"===e||"eternl"===e||"gerowallet"===e||"flint"===e):[],a=[];for await(const s of t)a.push(`<button id="${s}"><img src="${e[s].icon}">Connect ${s}</button>`);setState({dapps:a.join("")});for await(const e of t){const t=document.getElementById(e);t.addEventListener("click",connectDapp,!1),t.dappName=e}}catch(e){console.log(e)}}async function connectDapp(e){const t=e.currentTarget.dappName;setState({formHidden:!0,buttonLabel:"Searching..."});try{const r=await getCardano();if(r[t]){const e=await r[t].enable(),o=await e.getUsedAddresses(),i=await e.getUnusedAddresses(),l="8dd5717e7d4d993019dbd788c19837910e3fcf647ab282f828c80a7a",d=o.concat(i),c=[];for await(const e of d){const t=await fetch(server_url+"/AssetsFromBytes/"+e,{dataType:"jsonp",method:"GET"}),s=await t.json();for(var a=0;a<s.assets.length;a++)s.assets[a].filter(function(e){return e.unit.startsWith(l)}).length>0&&c.push(s.address)}var s=[],n=0;for await(const e of c){const t=await fetch(server_url+"/CheckPoolPm/"+e,{dataType:"jsonp",method:"GET"});(await t.json()).tokens.map(e=>{if(e.policy.startsWith(l)&&e.quantity>0){n+=1;var t=convertASCIItoHex(e.name),a=l+t,r=e.metadata,o="https://infura-ipfs.io/ipfs/"+r.image.replace("ipfs://",""),i={asset_id:a,description:r.description,name:r.name,imageURL:o,rarities:r["rare biomes"],moons:r.moons,galaxyType:r["galaxy type"],viewerIpfs:r.files[0].src.replace("ipfs://",""),rings:r.rings,planetType:r["planet type"],planetName:r["planet name"],planetSize:r["planet size"],atmosphere:r.atmosphere,rarityRank:"Unavailable",rarityScore:"Unavailable"};console.log(rarityTools[e.name]),console.log(e.name),rarityTools&&(i.rarityRank=rarityTools[e.name],i.rarityScore=rarityTools[e.name].rarityScore),s=s.concat(i)}})}setState(0==n?{notFoundText:"CardaWorlds not found for this address. Please check the address or try again.",all_nfts:s}:{notFoundText:"",all_nfts:s})}}catch(e){console.error(e)}finally{setState({formHidden:!1,buttonLabel:"Search"})}}observer.observe(document,{childList:!0,subtree:!0}),(async()=>{window.onload=instantiateDapps(await getCardano())})();