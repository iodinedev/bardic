"use strict";const walletAddress=document.getElementById("search"),searchButton=document.getElementById("searchButton"),notFound=document.getElementById("notfound"),assets=document.getElementById("assets"),dapps=document.getElementById("dapps"),form=document.getElementById("form"),loader=document.getElementById("loader"),server_url="http://preview.cardaworlds.io";async function getRarities(){try{const e=await fetch(server_url+"/GetRarityRanks",{dataType:"json",method:"GET",headers:{"Content-Type":"application/json"}});return await e.json()}catch(e){return console.log(e),notFound.innerHTML="There was an error loading part of the script. Rarity information is temporarily unavailable.",null}}var rarityTools;async function searchAddress(){const e={all_nfts:[],walletAddress:walletAddress.value,policyID:"8dd5717e7d4d993019dbd788c19837910e3fcf647ab282f828c80a7a"},a=convertASCIItoHex(e.walletAddress);console.log(e.walletAddress),console.log(a),setState({formHidden:!0,buttonLabel:"Searching..."}),e.walletAddress.startsWith("CardaWorld")?getNftDetails(rarityTools,e.all_nfts,e.policyID+a):e.walletAddress.startsWith("addr1")?fetch(server_url+"/CheckPoolPm/"+e.walletAddress,{dataType:"jsonp",method:"GET"}).then(e=>e.json()).then(a=>{var t=a.tokens,s=0;t.map(a=>{if(a.policy.startsWith(e.policyID)&&a.quantity>0){s+=1;var t=convertASCIItoHex(a.name),r=e.policyID+t,n=a.metadata,o="https://infura-ipfs.io/ipfs/"+n.image.replace("ipfs://",""),i={asset_id:r,description:n.description,name:n.name,imageURL:o,rarities:n["rare biomes"],moons:n.moons,galaxyType:n["galaxy type"],viewerIpfs:n.files[0].src.replace("ipfs://",""),rings:n.rings,planetType:n["planet type"],planetName:n["planet name"],planetSize:n["planet size"],atmosphere:n.atmosphere,rarityRank:"Unavailable",rarityScore:"Unavailable"};rarityTools&&(i.rarityRank=rarityTools[a.name].rarityRank,i.rarityScore=rarityTools[a.name].rarityScore),e.all_nfts=e.all_nfts.concat(i)}}),setState(0==s?{formHidden:!1,buttonLabel:"Search",notFoundText:"CardaWorlds not found for this address. Please check the address or try again.",all_nfts:e.all_nfts}:{formHidden:!1,buttonLabel:"Search",notFoundText:"",all_nfts:e.all_nfts})}).catch(e=>{console.log(e),setState({formHidden:!1,buttonLabel:"Search",notFoundText:"CardaWorlds not found for this address. Please check the address or try again."})}):(setState({formHidden:!1,buttonLabel:"Search",notFoundText:"CardaWorlds not found for this address. Please enter a valid address."}),console.log("Please enter a valid address")),setState({all_nfts:[]})}function getNftDetails(e,a,t){fetch(server_url+"/CheckAsset/"+t,{dataType:"jsonp",method:"GET"}).then(e=>e.json()).then(t=>{var s=t.onchain_metadata,r="https://infura-ipfs.io/ipfs/"+s.image.replace("ipfs://",""),n={asset_id:t.asset,asset_name:t.name,name:s.name,imageURL:r,rarities:s["rare biomes"],moons:s.moons,galaxyType:s["galaxy type"],viewerIpfs:s.files[0].src.replace("ipfs://",""),rings:s.rings,planetType:s["planet type"],planetName:s["planet name"],planetSize:s["planet size"],atmosphere:s.atmosphere,rarityRank:"Unavailable",rarityScore:"Unavailable"};e&&(n.rarityRank=e[s.name.replace(" #","")].rarityRank,n.rarityScore=e[s.name.replace(" #","")].rarityScore),t.quantity>0&&setState({all_nfts:a.concat(n),formHidden:!1,buttonLabel:"Search",notFoundText:""})}).catch(e=>{console.log(e)})}function setState(e){if(void 0!==e.formHidden&&(e.formHidden?(form.style.display="none",loader.style.display="block"):(form.style.display="block",loader.style.display="none")),void 0!==e.buttonLabel&&(searchButton.innerHTML=e.buttonLabel),void 0!==e.notFoundText&&(notFound.innerHTML=e.notFoundText),void 0!==e.dapps&&(dapps.innerHTML=e.dapps),void 0!==e.all_nfts){const a=[];for(const t in e.all_nfts){const s=e.all_nfts[t];a.push('<div class="asset">'),a.push(`<img src="${s.imageURL}">`),a.push(`<h3>${s.name}</h3>`),a.push(`<h4>${s.planetName}</h4>`),a.push("<p>Features</p>"),a.push('<div class="features">'),"No"!==s.moons&&a.push('<div class="feature">Moons</div>'),"No"!==s.rings&&a.push('<div class="feature">Gyros</div>'),a.push(`<div class="feature">${s.planetType}</div>`),a.push(`<div class="feature">${s.galaxyType} Galaxy</div>`),a.push(`<div class="feature">${s.atmosphere} Atmosphere</div>`),a.push(`<div class="feature">${s.rarities}</div>`),a.push("</div>"),a.push("<p>Rarity</p>"),a.push('<div class="features features__rarity">'),a.push(`<div class="feature">Rarity rank: ${s.rarityRank}</div>`),a.push(`<div class="feature">Rarity score: ${s.rarityScore}</div>`),a.push("</div>"),a.push('<div style="display: flex;gap: 30px;">'),a.push(`<a class="vr" href="https://www.jpg.store/asset/${s.asset_id}" target="_blank" rel="noopener noreferrer">More Details</a>`),a.push(`<a class="vr" href="https://ipfs.cardaworlds.io/ipfs/${s.viewerIpfs}" target="_blank" rel="noopener noreferrer">View in 3D</a>`),a.push("</div>"),a.push("</div>")}assets.innerHTML=a.join("")}}function convertASCIItoHex(e){const a=[],t=e.split("");for(let e=0;e<t.length;e++){const s=t[e].charCodeAt(0).toString(16);a.push(s)}return a.join("")}walletAddress.addEventListener("keypress",function(e){"Enter"===e.key&&searchButton.click()}),(async()=>{rarityTools=await getRarities()})();const isBrowser=()=>"undefined"!=typeof window;function getCardano(){return isBrowser()&&window.cardano}async function instantiateDapps(){const e=getCardano();console.log(e);const a=e?Object.keys(e).filter(e=>"nami"===e||"eternl"===e||"gerowallet"===e||"flint"===e):[],t=[];for(const s of a)t.push(`<button onclick="javascript:connectDapp('${s}')"><img src="${e[s].icon}"> Connect ${s}</button>`);setState({dapps:t.join("")})}async function connectDapp(e){setState({formHidden:!0,buttonLabel:"Searching..."});const a=getCardano();if(a[e]){const n=await a[e].enable(),o=await n.getUsedAddresses(),i=await n.getUnusedAddresses(),l="8dd5717e7d4d993019dbd788c19837910e3fcf647ab282f828c80a7a",d=o.concat(i),c=[];for await(const e of d){const a=await fetch(server_url+"/AssetsFromBytes/"+e,{dataType:"jsonp",method:"GET"}),s=await a.json();for(var t=0;t<s.assets.length;t++){s.assets[t].filter(function(e){return e.unit.startsWith(l)}).length>0&&c.push(s.address)}}var s=[],r=0;console.log(rarityTools);for await(const e of c){const a=await fetch(server_url+"/CheckPoolPm/"+e,{dataType:"jsonp",method:"GET"});(await a.json()).tokens.map(e=>{if(e.policy.startsWith(l)&&e.quantity>0){r+=1;var a=convertASCIItoHex(e.name),t=l+a,n=e.metadata,o="https://infura-ipfs.io/ipfs/"+n.image.replace("ipfs://",""),i={asset_id:t,description:n.description,name:n.name,imageURL:o,rarities:n["rare biomes"],moons:n.moons,galaxyType:n["galaxy type"],viewerIpfs:n.files[0].src.replace("ipfs://",""),rings:n.rings,planetType:n["planet type"],planetName:n["planet name"],planetSize:n["planet size"],atmosphere:n.atmosphere,rarityRank:"Unavailable",rarityScore:"Unavailable"};rarityTools&&(i.rarityRank=rarityTools[e.name].rarityRank,i.rarityScore=rarityTools[e.name].rarityScore),s=s.concat(i)}})}console.log(s),setState(0==r?{formHidden:!1,buttonLabel:"Search",notFoundText:"CardaWorlds not found for this address. Please check the address or try again.",all_nfts:s}:{formHidden:!1,buttonLabel:"Search",notFoundText:"",all_nfts:s})}}instantiateDapps();